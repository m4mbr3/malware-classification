import os
import sys
import json
import progressbar

# import numpy as np
from scipy.sparse import csr_matrix, vstack

# from sklearn import svm

"""absolute DIR of the program"""
DIR  = os.path.abspath(sys.argv[1])
"""Contains the dataset"""
matrix = None
"""Status bar"""
bar = None

"""LoadJSON"""
def loadJSON(f):
    global matrix
    with open (DIR+ "/" + f, "r") as fd:
        data = json.load(fd)
        x = []
        y = []
        for key, el in data.iteritems():
            if key not in ['bytes_path',
                           'id',
                           'family',
                           'asm_path']:
                x.append(el)

        y.append(data['family'])
        if matrix == None:
            matrix = csr_matrix(x)
        else:
            matrix = vstack([matrix,x])

"""Sfm trainer main function"""
def svm_trainer():
    global bar
    for root, dirs, filenames in os.walk(DIR):
        bar = progressbar.ProgressBar(
            len(filter(lambda x:x.endswith(".json"), filenames)))
        i = 0
        for f in filter(lambda x:x.endswith(".json"), filenames):
            loadJSON(f)
            bar.update(i)

        print len(matrix)


if __name__ == "__main__":
    svm_trainer()
